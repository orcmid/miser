HRESULTs.txt 0.0.3                  UTF-8                          2026-02-07
*---|----1----|----2----|----3----|----4----|----5----|----6----|----7----|--*

                                 OMISER CODE

                          OMISER USE OF HRESULTS
                          ======================

    HRESULTs are a convention for returning, possibly passing-on, result codes
    from API functions.  Although heavily employed in Microsoft Windows and
    the Component Object Model (COM) on several platforms, these codes are
    adopted for the oMiser API in a manner consistent with interoperaable
    operation of COM-style interfaces and methods on additional platforms.

    Although harmonious with the use in COM operations, this does not imply
    that oMiser will be distributed as a COM library.  Nevertheless HRESULTs
    are used in the COM-compatible APIs relied upon in oFrugal.

    Common HRESULT values are used where applicable.  For oMiser-specific
    error codes, the HRESULT extension mechanism is used.

    These are the common ones from facilities 0 (FACILITY_NULL) and 7
    (FACILITY_WIN32), as described by Microsoft:

              S_OK 0x00000000 Success
           S_FALSE 0x00000001 Success
         E_NOTIMPL 0x80004001 Not implemented
     E_NOINTERFACE 0x80004002 No such interface supported
         E_POINTER 0x80004003 Pointer that is not valid
           E_ABORT 0x80004004 Operation aborted
            E_FAIL 0x80004006 Unspecified failure
      E_UNEXPECTED 0x8000FFFF Unexpected failure
    E_ACCESSDENIED 0x80070005 General access denied error
          E_HANDLE 0x80070006 Handle that is not valid (not oMiser applicable)
     E_OUTOFMEMORY 0x8007000E Failed to allocated necessary memory
      E_INVALIDARG 0x80070057 One or more arguments are not valid

    The FACILITY_ITF (4), with HRESULTs 0x8004xxxx is for interface-specific
    responses to use of a particular interface.  These are specified in
    conjunction with individual interface contracts.  Any new ones required
    by oMiser will be in this category.  They will have codes of 0x80040200
    or greater to avoid ones COM uses for some of its interfaces.  This is
    according to [Rogerson1997] even though that may be dated information.
    Playing safe here.

    The naming of oMiser HRESULTS in FACILITY_ITF will all be in the form
    OM_E_reason and described with oMiser API and interface methods
    that deliver such an HRESULT.  Duplications (or not) for multiple/groups
    of interfaces will be figured out when the situation comes up.

    Here is the current list:

       OM_E_CLSID_UNSUPPORTED 0x80040200  from omEstablish()

    SOURCES

 * <https://learn.microsoft.com/en-us/windows/win32/seccrypto/common-hresult-values>
   source of the main ones listed above

 * <https://learn.microsoft.com/en-us/windows/win32/learnwin32/error-handling-in-com>

 * <https://learn.microsoft.com/en-us/windows/win32/com/structure-of-com-error-codes>
   this provides expanded structure detail.  Although there is provision
   for being vendor-specific, I intend to always use the simple structure
   with FACILITY_ITF and nothing else.

 * <https://learn.microsoft.com/en-us/windows/win32/winprog/windows-data-types>
   This document indicates that HRESULT and related macros are defined in
   WinNT.h rather than WinDef.h.  I need to figure that out.  (There are
   other headers mentioned in the listing here also.)

 * winerror.h header
   <https://learn.microsoft.com/en-us/windows/win32/api/winerror/>
   provides functions HRESULT_CODE, HRESULT_FACILITY, and HRESULT_SEVERITY
   for taking apart an HRESULT.  That's unlikely to be needed in oMiser
   and oFrugal.
     NOTE: There are some case differences (e.g., also Winerror.h) and it
   needs to be determined whether there is any difference.  It will be
   necessary to dig into the Microsoft SDK.

 * COM Error codes
   <https://learn.microsoft.com/en-us/windows/win32/com/com-error-codes-1>
   facilities 0 (FACILITY_NULL) and 4 (FACILITY_ITF)

 * <https://learn.microsoft.com/en-us/windows/win32/winprog64/the-new-data-types>
   is related to COM and oMiser but point out some gimmicks between x86 and
   x64 changes in things such as pointer size, etc.  We want to be specific
   to x64, and that matters because we have pointers in COM Interface vtables.
   This page refers to BaseTsd.h and there's coverage at the already-linked
   <https://learn.microsoft.com/en-us/windows/win32/winprog/windows-data-types>

[Rogerson1997]
    Rogerson, Dale.  Inside COM. Microsoft Press (Redmond, WA: 1997).  ISBN
    1-57321-349-8.  <https://orcmid.github.io/bib/progsys.htm#Rogerson1997>.


*---|----1----|----2----|----3----|----4----|----5----|----6----|----7----|--*

                     Copyright 2026 Dennis E. Hamilton

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

*---|----1----|----2----|----3----|----4----|----5----|----6----|----7----|--*

 ATTRIBUTION

   Hamilton, Dennis E. oMiser Use of HRESULTs.  Text file version 0.0.3
   dated 2026-02-07, available on the Internet as a version of
   <https://github.com/orcmid/miser/blob/master/devLab/oMiser/HRESULTs.txt>.

*---|----1----|----2----|----3----|----4----|----5----|----6----|----7----|--*

NOTES AND TODOS

 * This will ultimately be a PGP-signed distributed src.txt in a snapshot
   bundle.

 * I need a block of GUIDs that should last for all the interfaces we will
   need.

 * I need a block of HRESULTs and definition of oFrugal method-specific ones.
   See [Rogerson1997] HRESULTs, p.104.

 * I might want to refer to [Box1998] as well as [Rogerson1997] and cross
   check.


*---|----1----|----2----|----3----|----4----|----5----|----6----|----7----|--*

 0.0.3 2026-02-07T17:23Z Start introducing oMiser HRESULTs
 0.0.2 2026-01-24T20:30Z More wrestling with Microsoft source materials
 0.0.1 2026-01-15T17:05Z Move to oMiser/ and touch-up, supply [Rogerson1997]
 0.0.0 2026-01-14T23:30Z Initial draft on HRESULTs

                        ***** end of HRESULTS.txt *****
